<!DOCTYPE html>
<html>
<head>
	<title>Week 4 Game stat checker</title>
</head>
<body>
	<h2>Week 4 Stat Checker</h2>
	<p>Replace any/all of the default values and press Test. All possible win scenarios (or "character cannot win") for each character will be listed.</p>

	<label>Name</label><br/>
	<input type="text" id="name_0" value="Luke">
	<input type="text" id="name_1" value="Yoda">
	<input type="text" id="name_2" value="Han">
	<input type="text" id="name_3" value="Vader">
	<br/><br/>

	<label>HP</label><br/>
	<input type="text" id="hp_0" value="100">
	<input type="text" id="hp_1" value="90">
	<input type="text" id="hp_2" value="110">
	<input type="text" id="hp_3" value="120">
	<br/><br/>

	<label>Attack</label><br/>
	<input type="text" id="attack_0" value="11">
	<input type="text" id="attack_1" value="15">
	<input type="text" id="attack_2" value="10">
	<input type="text" id="attack_3" value="16">
	<br/><br/>

	<label>CounterAttack</label><br/>
	<input type="text" id="counter_0" value="30">
	<input type="text" id="counter_1" value="25">
	<input type="text" id="counter_2" value="15">
	<input type="text" id="counter_3" value="20">
	<br/><br/>

	<button>Test</button>
	<br/><br/>

	<div id="result"></div>

	<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
	<script type="text/javascript">
		$("button").on('click', function() {
			$("#result").empty();
			checkStats();
		});

		function checkStats() {
			let charArray = [{}, {}, {}, {}];

			for (let i = 0; i < 4; i++) {
				charArray[i].index = i;
				charArray[i].name = $("#name_" + i).val();
				charArray[i].hp = parseInt($("#hp_" + i).val());
				charArray[i].attack = parseInt($("#attack_" + i).val());
				charArray[i].counter = parseInt($("#counter_" + i).val());
			}

			for (let i = 0; i < 4; i++) {
				let resultArr = [];
				
				checkAllEnemies([], charArray[i], charArray[i].attack);

				// debugger;
				if (resultArr.length > 0) {
					for (let j = 0; j < resultArr.length; j++) {
						$("#result").append(charArray[i].name + " can win by fighting in this order: "
							+ charArray[resultArr[j][0]].name + ", "
							+ charArray[resultArr[j][1]].name + ", "
							+ charArray[resultArr[j][2]].name + "<br/>");
					}
					if (resultArr.length == 6) {
						$("#result").append("<b>(" + charArray[i].name + " cannot lose!)</b><br/>");
					}
				}
				else {
					$("#result").append("<b>" + charArray[i].name + " cannot win.</b><br/>");
				}

				$("#result").append("<br/>");

				function checkAllEnemies(indexArr, player, atkpwr) {
					// debugger;
					let currentIndexArr;
					let currentPlayer;
					let currentAtkPwr;

					for (let i = 0; i < 4; i++) {
						currentIndexArr = indexArr.slice();
						currentPlayer = $.extend(true, {}, player);
						currentAtkPwr = atkpwr;

						if ((i != currentPlayer.index) && (currentIndexArr.indexOf(i) == -1)) {
							if (doBattle(charArray[i])) {
								currentIndexArr.push(i);
								if (currentIndexArr.length > 2) {
									resultArr.push(currentIndexArr);
								}
								else {
									checkAllEnemies(currentIndexArr, currentPlayer, currentAtkPwr);
								}
							}
						}
					}

					function doBattle(enemy) {
						// debugger;
						let tempPlayer = $.extend(true, {}, currentPlayer);
						let tempEnemy = $.extend(true, {}, enemy);
						let tempPlayerAtkPwr = currentAtkPwr;
						
						while (tempEnemy.hp > 0 && tempPlayer.hp > 0) {
							tempEnemy.hp -= tempPlayerAtkPwr;
							tempPlayerAtkPwr += currentPlayer.attack;

							if (tempEnemy.hp <= 0) {
								currentPlayer = tempPlayer;
								currentAtkPwr = tempPlayerAtkPwr;
								return true;
							}
							
							tempPlayer.hp -= tempEnemy.counter;
							
							if (tempPlayer.hp <= 0) { return false; }
						}
					}
				}
			}
		}
	</script>
</body>
</html>